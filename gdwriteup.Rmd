---
title: "WriteUp"
author: "Connor Beebe"
date: "2024-02-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Preface

Employees are the heart and soul of a business. Their actions and performance are what drive the profitability of a business and it's ability to maximize shareholder value. In the following document, we look to address the following question:

*Is there a relationship between employee sentiment and excess returns?*

By building a webscraping program and applying it to GlassDoor, we were able to compile thousands of employee reviews across a variety of companies:

-   ExxonMobil (XOM)
-   Chevron (CVX)
-   Shell (SHEL)
-   BP (BP)

For context on the analysis that occurs below, here is a chart that represents their respective share prices from the last 10 years:

```{r}

```

We wanted to select companies that all operate in the same industry and differ by market cap. This ensures that our analysis truly represents differentiating factors in relation to excess returns.

Firstly, we needed to make sense of all the reviews and how best to compile and analyze them. Natural Language processing is the computational analysis of language and speech. This essentially analyzes words and phrases and rates them numerically or categorically based off of the emotion and message they are conveying. Here is a short description of the two methods we applied:

-   Bing: A dataset of 6,786 words with binary positive and negative sentiment scores:

```{r}
library(gt)
p <- bing %>% slice_head(n = 3) 
n <- bing %>% slice_tail(n = 3)
b <- rbind(p, n)
b %>% gt() %>% tab_options(
  data_row.padding = px(6),
  heading.align = 'left',
  column_labels.background.color = 'dodgerblue4',
  heading.title.font.size = 26,
  footnotes.font.size = 8
) %>% 
  tab_style(style = cell_text(color = 'dodgerblue4',
                              weight = 'bold'),
            locations = cells_title(groups = 'title')) %>% tab_options(table.font.size = 10, heading.title.font.size = 15)
```

-   Afinn: A dataset of 2477 words with scores ranging from -5 to 5:

```{r}
ap <- afinn %>% slice_head(n = 500)
an <- afinn %>% slice_tail(n = 500)
a <- rbind(ap,an) %>% arrange(desc(value)) %>% slice_head(n = 6)
a %>% gt() %>% tab_options(
  data_row.padding = px(6),
  heading.align = 'left',
  column_labels.background.color = 'dodgerblue4',
  heading.title.font.size = 26,
  footnotes.font.size = 8
) %>% 
  tab_style(style = cell_text(color = 'dodgerblue4',
                              weight = 'bold'),
            locations = cells_title(groups = 'title')) %>% tab_options(table.font.size = 10, heading.title.font.size = 15)
```

We also utilized the star ratings that employees leave whenever a review is posted (ranging from 1 star to 5 stars). To organize our data into workable metrics. We used individual words instead of ngrams (collection of words or short sentences) as the bulk of the reviews are short and sometimes contain only one word. To summarize, we opted for the following:

-   Grouped reviews into monthly, quarterly and annual bins.
-   Bing was organized into percentage of reviews that were deemed positive and averaged over monthly, quarterly and annually.
-   Afinn was organized into average total score over monthly, quarterly and annually.
-   Star ratings were averaged over monthly, quarterly and annually.

Here are some visuals that are separated by company, depicting how these various metrics change through time. All charts use monthly data to help tell the story:

```{r}
review_comb %>% plot_ly(x = ~month,
                    y = ~meanRateMon,
                    color = ~company,
                    type = 'scatter',
                    mode = 'lines') %>% layout(title = "Average Monthly Star Reviews",
         xaxis = list(title = ""),
         yaxis = list(title = "Stars"))
```

```{r}
review_comb %>% filter(month >'2013-12-31') %>% 
  ggplot(aes(x = month, y = sentiment, fill = sentiment)) +
  geom_bar(stat = "identity", position = "dodge", show.legend = FALSE) +
  facet_wrap(~ company, scales = "free_x") +
  scale_fill_viridis_c() +
  theme_minimal() +
  labs(title = "Afinn Analysis by Company and Date",
       x = "",
       y = "Sentiment Score") +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
```{r}
ratings %>%
  select(date, Company, reviewtext) %>%
  filter(date > "2013-12-31") %>% 
  unnest_tokens(output = word, input = reviewtext) %>%  inner_join(afinn) %>% filter(Company == 'bp') %>% 
  filter(date > '2018-01-01' & date < '2018-01-31')
```


```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(scales)

library(ggplot2)
library(dplyr)


bing_nlp$month <- as.Date(bing_nlp$month)

ggplot(data = bing_nlp, aes(x = month)) +
  geom_bar(aes(y = negative, fill = 'negative'), stat = "identity") +
  geom_bar(aes(y = positive, fill = 'positive'), stat = "identity", alpha = 0.5) +
  geom_line(aes(y = percent_positive, group = company, color = company), size = 1) +
  facet_wrap(~ company, scales = "free_y") +
  theme_minimal() +
  scale_fill_manual(values = c("negative" = "red", "positive" = "green")) +
  scale_color_viridis_d() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) +
  labs(fill = "Review Sentiment", color = "Company",
       x = "", y = "Review Sentiment / Percent Positive")

```


